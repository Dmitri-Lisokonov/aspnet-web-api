ö)
dE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Context\GoogleUserContext.cs
	namespace 	
aspnet_web_api
 
. 
Context  
{ 
public		 

class		 
GoogleUserContext		 "
{

 
DatabaseManager 
_manager  
;  !
DataTableConverter 

_converter %
;% &
string 
connectionString 
=  !
$str" A
;A B
public 
GoogleUserContext  
(  !
)! "
{ 	

_converter 
= 
new 
DataTableConverter /
(/ 0
)0 1
;1 2
_manager 
= 
new 
DatabaseManager *
(* +
connectionString+ ;
); <
;< =
} 	
public 
User 

GetByEmail 
( 
string %
email& +
)+ ,
{ 	
List 
< 
User 
> 
users 
= 
new "
List# '
<' (
User( ,
>, -
(- .
). /
;/ 0

Dictionary 
< 
string 
, 
string %
>% &
dict' +
=, -
new. 1

Dictionary2 <
<< =
string= C
,C D
stringE K
>K L
(L M
)M N
;N O
dict 
. 
Add 
( 
$str 
, 
email $
)$ %
;% &
string 
query 
= 
$" 
$str W
"W X
;X Y
	DataTable 
table 
= 
_manager &
.& '
ExecuteQuery' 3
(3 4
query4 9
,9 :
true; ?
,? @
dictA E
)E F
;F G
if 
( 
table 
!= 
null 
&&  
table! &
.& '
Rows' +
.+ ,
Count, 1
>2 3
$num4 5
)5 6
{ 
users 
= 

_converter "
." #
ConvertToGoogleUser# 6
(6 7
table7 <
)< =
;= >
return 
users 
[ 
$num 
] 
;  
}   
else!! 
{"" 
return## 
null## 
;## 
}$$ 
}%% 	
public'' 
User'' 
	CreateNew'' 
('' 
User'' "
user''# '
)''' (
{(( 	

Dictionary)) 
<)) 
string)) 
,)) 
string)) %
>))% &
dict))' +
=)), -
new)). 1

Dictionary))2 <
<))< =
string))= C
,))C D
string))E K
>))K L
())L M
)))M N
;))N O
dict** 
.** 
Add** 
(** 
$str** 
,** 
user** #
.**# $
Email**$ )
)**) *
;*** +
dict++ 
.++ 
Add++ 
(++ 
$str++ 
,++ 
user++ "
.++" #
Name++# '
)++' (
;++( )
dict,, 
.,, 
Add,, 
(,, 
$str,, 
,,, 
user,, "
.,," #
Role,,# '
),,' (
;,,( )
string-- 
query-- 
=-- 
$"-- 
$str-- e
"--e f
;--f g
try.. 
{// 
	DataTable00 
table00 
=00  !
_manager00" *
.00* +
ExecuteQuery00+ 7
(007 8
query008 =
,00= >
true00? C
,00C D
dict00E I
)00I J
;00J K
if11 
(11 
table11 
!=11 
null11 !
&&11" $
table11% *
.11* +
Rows11+ /
.11/ 0
Count110 5
>116 7
$num118 9
)119 :
{22 
List33 
<33 
User33 
>33 
createdUser33 *
=33+ ,
new33- 0
List331 5
<335 6
User336 :
>33: ;
(33; <
)33< =
;33= >
createdUser44 
=44  !

_converter44" ,
.44, -
ConvertToUser44- :
(44: ;
table44; @
)44@ A
;44A B
return55 
createdUser55 &
[55& '
$num55' (
]55( )
;55) *
}66 
else77 
{88 
return99 
null99 
;99  
}:: 
}<< 
catch== 
(== 
	Exception== 
e== 
)== 
{>> 
return?? 
null?? 
;?? 
}@@ 
}AA 	
}BB 
}CC ™
aE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Context\ProductContext.cs
	namespace 	
aspnet_web_api
 
. 
Context  
{ 
public		 

class		 
ProductContext		 
{

 
DatabaseManager 
manager 
;  
DataTableConverter 
	converter $
;$ %
string 
connectionString 
=  !
$str" A
;A B
public 
ProductContext 
( 
) 
{ 	
	converter 
= 
new 
DataTableConverter .
(. /
)/ 0
;0 1
manager 
= 
new 
DatabaseManager )
() *
connectionString* :
): ;
;; <
} 	
public 
List 
< 
Product 
> 
GetAll #
(# $
)$ %
{ 	
List 
< 
Product 
> 
products "
=# $
new% (
List) -
<- .
Product. 5
>5 6
(6 7
)7 8
;8 9
string 
query 
= 
$str 2
;2 3
	DataTable 
table 
= 
manager %
.% &
ExecuteQuery& 2
(2 3
query3 8
,8 9
false: ?
)? @
;@ A
try 
{ 
products 
= 
	converter $
.$ %
ConvertToProduct% 5
(5 6
table6 ;
); <
;< =
} 
catch 
( 
	Exception 
e 
) 
{ 
return 
null 
; 
}   
return"" 
products"" 
;"" 
}## 	
}$$ 
}%% Ïb
^E:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Context\UserContext.cs
	namespace		 	
aspnet_web_api		
 
.		 
Context		  
{

 
public 

class 
UserContext 
{ 
private 
DatabaseManager 
_manager  (
;( )
private 
DataTableConverter "

_converter# -
;- .
string 
connectionString 
=  !
$str" A
;A B
public 
UserContext 
( 
) 
{ 	

_converter 
= 
new 
DataTableConverter /
(/ 0
)0 1
;1 2
_manager 
= 
new 
DatabaseManager *
(* +
connectionString+ ;
); <
;< =
} 	
public 
User 

GetByEmail 
( 
string %
email& +
)+ ,
{ 	
Console 
. 
	WriteLine 
( 
$str '
)' (
;( )
Console 
. 
	WriteLine 
( 
email #
)# $
;$ %
List 
< 
User 
> 
users 
= 
new "
List# '
<' (
User( ,
>, -
(- .
). /
;/ 0

Dictionary 
< 
string 
, 
string %
>% &
dict' +
=, -
new. 1

Dictionary2 <
<< =
string= C
,C D
stringE K
>K L
(L M
)M N
;N O
dict 
. 
Add 
( 
$str 
, 
email $
)$ %
;% &
string 
query 
= 
$" 
$str I
"I J
;J K
	DataTable 
table 
= 
_manager &
.& '
ExecuteQuery' 3
(3 4
query4 9
,9 :
true; ?
,? @
dictA E
)E F
;F G
if 
( 
table 
!= 
null 
&&  
table! &
.& '
Rows' +
.+ ,
Count, 1
>2 3
$num4 5
)5 6
{   
Console!! 
.!! 
	WriteLine!! !
(!!! "
$str!!" .
)!!. /
;!!/ 0
users"" 
="" 

_converter"" "
.""" #
ConvertToUser""# 0
(""0 1
table""1 6
)""6 7
;""7 8
return## 
users## 
[## 
$num## 
]## 
;##  
}$$ 
else%% 
{&& 
Console'' 
.'' 
	WriteLine'' !
(''! "
$str''" 0
)''0 1
;''1 2
return(( 
null(( 
;(( 
})) 
}** 	
public,, 
User,, 
GetByConfirmToken,, %
(,,% &
string,,& ,
token,,- 2
),,2 3
{-- 	
List// 
<// 
User// 
>// 
users// 
=// 
new// "
List//# '
<//' (
User//( ,
>//, -
(//- .
)//. /
;/// 0

Dictionary00 
<00 
string00 
,00 
string00 %
>00% &
dict00' +
=00, -
new00. 1

Dictionary002 <
<00< =
string00= C
,00C D
string00E K
>00K L
(00L M
)00M N
;00N O
dict11 
.11 
Add11 
(11 
$str11 *
,11* +
token11, 1
)111 2
;112 3
string22 
query22 
=22 
$"22 
$str22 c
"22c d
;22d e
	DataTable33 
table33 
=33 
_manager33 &
.33& '
ExecuteQuery33' 3
(333 4
query334 9
,339 :
true33; ?
,33? @
dict33A E
)33E F
;33F G
if44 
(44 
table44 
!=44 
null44 
&&44  
table44! &
.44& '
Rows44' +
.44+ ,
Count44, 1
>442 3
$num444 5
)445 6
{55 
users66 
=66 

_converter66 "
.66" #
ConvertToUser66# 0
(660 1
table661 6
)666 7
;667 8
return77 
users77 
[77 
$num77 
]77 
;77  
}88 
else99 
{:: 
return;; 
null;; 
;;; 
}<< 
}== 	
public?? 
bool?? 
	CreateNew?? 
(?? 
User?? "
user??# '
)??' (
{@@ 	

DictionaryAA 
<AA 
stringAA 
,AA 
stringAA %
>AA% &
dictAA' +
=AA, -
newAA. 1

DictionaryAA2 <
<AA< =
stringAA= C
,AAC D
stringAAE K
>AAK L
(AAL M
)AAM N
;AAN O
dictBB 
.BB 
AddBB 
(BB 
$strBB 
,BB 
userBB #
.BB# $
EmailBB$ )
)BB) *
;BB* +
dictCC 
.CC 
AddCC 
(CC 
$strCC 
,CC 
userCC "
.CC" #
NameCC# '
)CC' (
;CC( )
dictDD 
.DD 
AddDD 
(DD 
$strDD  
,DD  !
userDD" &
.DD& '
PasswordDD' /
)DD/ 0
;DD0 1
dictEE 
.EE 
AddEE 
(EE 
$strEE 
,EE 
userEE "
.EE" #
SaltEE# '
)EE' (
;EE( )
dictFF 
.FF 
AddFF 
(FF 
$strFF 
,FF 
userFF "
.FF" #
RoleFF# '
)FF' (
;FF( )
dictGG 
.GG 
AddGG 
(GG 
$strGG *
,GG* +
userGG, 0
.GG0 1
ConfirmationTokenGG1 B
)GGB C
;GGC D
stringHH 
queryHH 
=HH 
$"HH 
$str	HH ©
"
HH© ™
;
HH™ ´
tryII 
{JJ 
	DataTableKK 
tableKK 
=KK  !
_managerKK" *
.KK* +
ExecuteQueryKK+ 7
(KK7 8
queryKK8 =
,KK= >
trueKK? C
,KKC D
dictKKE I
)KKI J
;KKJ K
ifLL 
(LL 
tableLL 
!=LL 
nullLL  
)LL  !
{MM 
returnNN 
trueNN 
;NN  
}OO 
elsePP 
{QQ 
returnRR 
falseRR  
;RR  !
}SS 
}TT 
catchUU 
(UU 
	ExceptionUU 
eUU 
)UU 
{VV 
returnWW 
falseWW 
;WW 
}XX 
}YY 	
public[[ 
bool[[ 
VerifyEmail[[ 
([[  
string[[  &
confirmationToken[[' 8
)[[8 9
{\\ 	

Dictionary]] 
<]] 
string]] 
,]] 
string]] %
>]]% &
dict]]' +
=]], -
new]]. 1

Dictionary]]2 <
<]]< =
string]]= C
,]]C D
string]]E K
>]]K L
(]]L M
)]]M N
;]]N O
dict^^ 
.^^ 
Add^^ 
(^^ 
$str^^ *
,^^* +
confirmationToken^^, =
)^^= >
;^^> ?
string__ 
query__ 
=__ 
$"__ 
$str__ t
"__t u
;__u v
string`` 
update`` 
=`` 
$"`` 
$str`` i
"``i j
;``j k
tryaa 
{bb 
	DataTablecc 
checkcc 
=cc  !
_managercc" *
.cc* +
ExecuteQuerycc+ 7
(cc7 8
querycc8 =
,cc= >
truecc? C
,ccC D
dictccE I
)ccI J
;ccJ K
ifdd 
(dd 
checkdd 
.dd 
Rowsdd 
.dd 
Countdd #
>dd$ %
$numdd& '
)dd' (
{ee 
	DataTableff 
tableff #
=ff$ %
_managerff& .
.ff. /
ExecuteQueryff/ ;
(ff; <
updateff< B
,ffB C
trueffD H
,ffH I
dictffJ N
)ffN O
;ffO P
returngg 
truegg 
;gg  
}hh 
elseii 
{jj 
returnkk 
falsekk  
;kk  !
}ll 
}mm 
catchnn 
(nn 
	Exceptionnn 
enn 
)nn 
{oo 
returnpp 
falsepp 
;pp 
}qq 
}rr 	
publictt 
booltt 

UpdateUsertt 
(tt 
Usertt #
usertt$ (
)tt( )
{uu 	

Dictionaryvv 
<vv 
stringvv 
,vv 
stringvv %
>vv% &
dictvv' +
=vv, -
newvv. 1

Dictionaryvv2 <
<vv< =
stringvv= C
,vvC D
stringvvE K
>vvK L
(vvL M
)vvM N
;vvN O
dictww 
.ww 
Addww 
(ww 
$strww 
,ww 
userww #
.ww# $
Emailww$ )
)ww) *
;ww* +
dictxx 
.xx 
Addxx 
(xx 
$strxx 
,xx 
userxx "
.xx" #
Namexx# '
)xx' (
;xx( )
dictyy 
.yy 
Addyy 
(yy 
$stryy  
,yy  !
useryy" &
.yy& '
Passwordyy' /
)yy/ 0
;yy0 1
dictzz 
.zz 
Addzz 
(zz 
$strzz 
,zz 
userzz "
.zz" #
Saltzz# '
)zz' (
;zz( )
dict{{ 
.{{ 
Add{{ 
({{ 
$str{{ 
,{{ 
user{{ "
.{{" #
Role{{# '
){{' (
;{{( )
dict|| 
.|| 
Add|| 
(|| 
$str|| *
,||* +
user||, 0
.||0 1
ConfirmationToken||1 B
)||B C
;||C D
dict}} 
.}} 
Add}} 
(}} 
$str}} "
,}}" #
(}}$ %
user}}% )
.}}) *
	ResetDate}}* 3
-}}4 5
new}}6 9
DateTime}}: B
(}}B C
$num}}C G
,}}G H
$num}}I J
,}}J K
$num}}L M
)}}M N
)}}N O
.}}O P
TotalMilliseconds}}P a
.}}a b
ToString}}b j
(}}j k
)}}k l
)}}l m
;}}m n
string~~ 
query~~ 
=~~ 
$"~~ 
$str	~~ ª
"
~~ª º
+
~~Ω æ
user
~~ø √
.
~~√ ƒ
Id
~~ƒ ∆
;
~~∆ «
try 
{
ÄÄ 
	DataTable
ÅÅ 
table
ÅÅ 
=
ÅÅ  !
_manager
ÅÅ" *
.
ÅÅ* +
ExecuteQuery
ÅÅ+ 7
(
ÅÅ7 8
query
ÅÅ8 =
,
ÅÅ= >
true
ÅÅ? C
,
ÅÅC D
dict
ÅÅE I
)
ÅÅI J
;
ÅÅJ K
if
ÇÇ 
(
ÇÇ 
table
ÇÇ 
!=
ÇÇ 
null
ÇÇ !
)
ÇÇ! "
{
ÉÉ 
return
ÑÑ 
true
ÑÑ 
;
ÑÑ  
}
ÖÖ 
else
ÜÜ 
{
áá 
return
àà 
false
àà  
;
àà  !
}
ââ 
}
ää 
catch
ãã 
(
ãã 
	Exception
ãã 
e
ãã 
)
ãã 
{
åå 
return
çç 
false
çç 
;
çç 
}
éé 
}
êê 	
}
ëë 
}íí ø
kE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Controllers\GoogleUserController.cs
	namespace 	
aspnet_web_api
 
. 
Controllers $
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class  
GoogleUserController %
:& '
ControllerBase( 6
{ 
private  
GoogleUserRepository $
_repo% *
;* +
private 
readonly 
ILogger  
<  ! 
GoogleUserController! 5
>5 6
_logger7 >
;> ?
private 
GoogleOAuthHelper !
_authHelper" -
;- .
public  
GoogleUserController #
(# $
ILogger$ +
<+ , 
GoogleUserController, @
>@ A
loggerB H
,H I
IConfigurationJ X
configY _
)_ `
{ 	
_repo 
= 
new  
GoogleUserRepository ,
(, -
config- 3
)3 4
;4 5
_authHelper 
= 
new 
GoogleOAuthHelper /
(/ 0
)0 1
;1 2
_logger 
= 
logger 
; 
} 	
[ 	
HttpPost	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
IActionResult 
Authenticate )
() *
[* +
FromBody+ 3
]3 4
string5 ;
tokenId< C
)C D
{   	
try!! 
{"" 
UserViewModel## 
result## $
=##% &
_repo##' ,
.##, -
Authenticate##- 9
(##9 :
tokenId##: A
)##A B
;##B C
if$$ 
($$ 
result$$ 
!=$$ 
null$$ "
&&$$# %
!$$& '
result$$' -
.$$- .
Email$$. 3
.$$3 4
Equals$$4 :
($$: ;
$str$$; =
)$$= >
)$$> ?
{%% 
return&& 
Ok&& 
(&& 
new&& !
ResponseMessage&&" 1
(&&1 2
ResponseType&&2 >
.&&> ?
SUCCESS&&? F
,&&F G
JsonSerializer&&H V
.&&V W
	Serialize&&W `
(&&` a
result&&a g
)&&g h
)&&h i
)&&i j
;&&j k
}'' 
else(( 
{)) 
return** 

StatusCode** %
(**% &
$num**& )
,**) *
new**+ .
ResponseMessage**/ >
(**> ?
ResponseType**? K
.**K L
FAILED**L R
,**R S
$str**T w
)**w x
)**x y
;**y z
}++ 
},, 
catch-- 
(-- 
	Exception-- 
e-- 
)-- 
{.. 
return// 

StatusCode// !
(//! "
$num//" %
,//% &
new//' *
ResponseMessage//+ :
(//: ;
ResponseType//; G
.//G H
FAILED//H N
,//N O
$str	//P Å
)
//Å Ç
)
//Ç É
;
//É Ñ
}00 
}11 	
}33 
}44 ˜,
hE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Controllers\ProductController.cs
	namespace 	
aspnet_web_api
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ProductController "
:# $
ControllerBase% 3
{ 
private 
ProductRepository !
_repo" '
;' (
private 
readonly 
ILogger  
<  !
ProductController! 2
>2 3
_logger4 ;
;; <
private (
UserRoleAuthorizationManager ,
_authManager- 9
;9 :
public 
ProductController  
(  !
ILogger! (
<( )
ProductController) :
>: ;
logger< B
)B C
{ 	
_repo 
= 
new 
ProductRepository )
() *
)* +
;+ ,
_logger 
= 
logger 
; 
_authManager 
= 
new (
UserRoleAuthorizationManager ;
(; <
)< =
;= >
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 
) 
] 
[ 	 
ProducesResponseType	 
( 
StatusCodes )
.) *
Status200OK* 5
,5 6
Type7 ;
=< =
typeof> D
(D E
ProductE L
)L M
)M N
]N O
[   	 
ProducesResponseType  	 
(   
StatusCodes   )
.  ) *
Status404NotFound  * ;
)  ; <
]  < =
[!! 	 
ProducesResponseType!!	 
(!! 
StatusCodes!! )
.!!) *(
Status500InternalServerError!!* F
)!!F G
]!!G H
public"" 
IActionResult"" 
GetAll"" #
(""# $
)""$ %
{## 	
_logger$$ 
.$$ 
LogInformation$$ "
($$" #
$"$$# %
$str$$% =
{$$= >
Request$$> E
.$$E F
HttpContext$$F Q
.$$Q R

Connection$$R \
.$$\ ]
RemoteIpAddress$$] l
}$$l m
"$$m n
)$$n o
;$$o p
HttpContext%% 
currentUser%% #
=%%$ %
HttpContext%%& 1
;%%1 2
try&& 
{'' 
List(( 
<(( 
Product(( 
>(( 
products(( &
=((' (
_repo(() .
.((. /
GetAll((/ 5
(((5 6
)((6 7
;((7 8
if)) 
()) 
products)) 
.)) 
Count)) "
<))# $
$num))% &
)))& '
{** 
return++ 
NotFound++ #
(++# $
$str++$ 7
)++7 8
;++8 9
},, 
else-- 
{.. 
return// 
Ok// 
(// 
new// !
ResponseMessage//" 1
(//1 2
ResponseType//2 >
.//> ?
SUCCESS//? F
,//F G
JsonSerializer//H V
.//V W
	Serialize//W `
(//` a
products//a i
)//i j
)//j k
)//k l
;//l m
}00 
}11 
catch22 
(22 
	Exception22 
e22 
)22 
{33 
return44 

StatusCode44 !
(44! "
$num44" %
,44% &
new44' *
ResponseMessage44+ :
(44: ;
ResponseType44; G
.44G H
FAILED44H N
,44N O
$str	44P É
)
44É Ñ
)
44Ñ Ö
;
44Ö Ü
}55 
}77 	
[99 	
HttpGet99	 
]99 
[:: 	
	Authorize::	 
]:: 
[;; 	
Route;;	 
(;; 
$str;; 
);; 
];; 
public<< 
IActionResult<< 
GetSecretProduct<< -
(<<- .
)<<. /
{== 	
_logger>> 
.>> 
LogInformation>> "
(>>" #
$">># %
$str>>% ?
{>>? @
Request>>@ G
.>>G H
HttpContext>>H S
.>>S T

Connection>>T ^
.>>^ _
RemoteIpAddress>>_ n
}>>n o
">>o p
)>>p q
;>>q r
HttpContext?? 
currentUser?? #
=??$ %
HttpContext??& 1
;??1 2
bool@@ 
allowed@@ 
=@@ 
_authManager@@ '
.@@' (
AuthoriseAdmin@@( 6
(@@6 7
currentUser@@7 B
)@@B C
;@@C D
ifAA 
(AA 
allowedAA 
)AA 
{BB 
returnCC 
OkCC 
(CC 
newCC 
ResponseMessageCC -
(CC- .
ResponseTypeCC. :
.CC: ;
SUCCESSCC; B
,CCB C
$strCCD e
)CCe f
)CCf g
;CCg h
}DD 
elseEE 
{FF 
returnGG 

StatusCodeGG !
(GG! "
$numGG" %
,GG% &
newGG' *
ResponseMessageGG+ :
(GG: ;
ResponseTypeGG; G
.GGG H
FAILEDGGH N
,GGN O
$strGGP c
)GGc d
)GGd e
;GGe f
}HH 
}II 	
}JJ 
}KK §õ
eE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Controllers\UserController.cs
	namespace 	
aspnet_web_api
 
. 
Controllers $
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
UserController 
:  !
ControllerBase" 0
{ 
private 
UserRepository 
_repo $
;$ %
private 
readonly 
ILogger  
<  !
UserController! /
>/ 0
_logger1 8
;8 9
private (
UserRoleAuthorizationManager ,
_authManager- 9
;9 :
public 
UserController 
( 
ILogger %
<% &
UserController& 4
>4 5
logger6 <
,< =
IConfiguration> L
configM S
)S T
{ 	
_authManager 
= 
new (
UserRoleAuthorizationManager ;
(; <
)< =
;= >
_repo 
= 
new 
UserRepository &
(& '
config' -
)- .
;. /
_logger 
= 
logger 
; 
} 	
[ 	
HttpPost	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public   
IActionResult   
Register   %
(  % &
[  & '
FromBody  ' /
]  / 0
User  1 5
user  6 :
)  : ;
{!! 	
_logger"" 
."" 
LogInformation"" "
(""" #
$"""# %
$str""% @
{""@ A
Request""A H
.""H I
HttpContext""I T
.""T U

Connection""U _
.""_ `
RemoteIpAddress""` o
}""o p
"""p q
)""q r
;""r s
try$$ 
{%% 
UserViewModel&& 
fetchedUser&& )
=&&* +
_repo&&, 1
.&&1 2

GetByEmail&&2 <
(&&< =
user&&= A
.&&A B
Email&&B G
)&&G H
;&&H I
if(( 
((( 
fetchedUser(( 
!=((  "
null((# '
)((' (
{)) 
return** 

StatusCode** %
(**% &
$num**& )
,**) *
new**+ .
ResponseMessage**/ >
(**> ?
ResponseType**? K
.**K L
FAILED**L R
,**R S
$str**T l
)**l m
)**m n
;**n o
}++ 
else,, 
{-- 
string.. 
result.. !
=.." #
_repo..$ )
...) *
	CreateNew..* 3
(..3 4
user..4 8
)..8 9
;..9 :
if// 
(// 
result// 
.// 
Equals// %
(//% &
$str//& /
)/// 0
)//0 1
{00 
return11 

StatusCode11 )
(11) *
$num11* -
,11- .
new11/ 2
ResponseMessage113 B
(11B C
ResponseType11C O
.11O P
SUCCESS11P W
,11W X
$str11Y j
)11j k
)11k l
;11l m
}22 
else33 
if33 
(33 
result33 "
.33" #
Equals33# )
(33) *
$str33* 7
)337 8
)338 9
{44 
return55 

StatusCode55 )
(55) *
$num55* -
,55- .
new55/ 2
ResponseMessage553 B
(55B C
ResponseType55C O
.55O P
FAILED55P V
,55V W
$str	55X ò
)
55ò ô
)
55ô ö
;
55ö õ
}66 
else77 
{88 
return99 

StatusCode99 )
(99) *
$num99* -
,99- .
new99/ 2
ResponseMessage993 B
(99B C
ResponseType99C O
.99O P
FAILED99P V
,99V W
result99X ^
)99^ _
)99_ `
;99` a
}:: 
};; 
}<< 
catch== 
(== 
	Exception== 
e== 
)== 
{>> 
Console?? 
.?? 
	WriteLine?? !
(??! "
e??" #
)??# $
;??$ %
return@@ 

StatusCode@@ !
(@@! "
$num@@" %
,@@% &
new@@' *
ResponseMessage@@+ :
(@@: ;
ResponseType@@; G
.@@G H
FAILED@@H N
,@@N O
$str	@@P Å
)
@@Å Ç
)
@@Ç É
;
@@É Ñ
}AA 
}CC 	
[EE 	
HttpPostEE	 
]EE 
[FF 	
RouteFF	 
(FF 
$strFF 
)FF 
]FF 
publicGG 
IActionResultGG 
LoginGG "
(GG" #
[GG# $
FromBodyGG$ ,
]GG, -
UserGG. 2
userGG3 7
)GG7 8
{HH 	
_loggerII 
.II 
LogInformationII "
(II" #
$"II# %
$strII% <
{II< =
RequestII= D
.IID E
HttpContextIIE P
.IIP Q

ConnectionIIQ [
.II[ \
RemoteIpAddressII\ k
}IIk l
"IIl m
)IIm n
;IIn o
tryJJ 
{KK 
UserViewModelLL 
resultLL $
=LL% &
_repoLL' ,
.LL, -
LoginLL- 2
(LL2 3
userLL3 7
)LL7 8
;LL8 9
ifMM 
(MM 
resultMM 
!=MM 
nullMM "
&&MM# %
!MM& '
resultMM' -
.MM- .
EmailMM. 3
.MM3 4
EqualsMM4 :
(MM: ;
$strMM; =
)MM= >
&&MM? A
resultMMB H
.MMH I
VerifiedMMI Q
)MMQ R
{NN 
_loggerOO 
.OO 
LogInformationOO *
(OO* +
$"OO+ -
$strOO- L
{OOL M
RequestOOM T
.OOT U
HttpContextOOU `
.OO` a

ConnectionOOa k
.OOk l
RemoteIpAddressOOl {
}OO{ |
"OO| }
)OO} ~
;OO~ 
returnPP 
OkPP 
(PP 
newPP !
ResponseMessagePP" 1
(PP1 2
ResponseTypePP2 >
.PP> ?
SUCCESSPP? F
,PPF G
JsonSerializerPPH V
.PPV W
	SerializePPW `
(PP` a
resultPPa g
)PPg h
)PPh i
)PPi j
;PPj k
}QQ 
elseRR 
ifRR 
(RR 
resultRR 
!=RR !
nullRR" &
&&RR' )
!RR* +
resultRR+ 1
.RR1 2
VerifiedRR2 :
)RR: ;
{RR< =
_loggerSS 
.SS 
LogInformationSS *
(SS* +
$"SS+ -
$strSS- K
{SSK L
RequestSSL S
.SSS T
HttpContextSST _
.SS_ `

ConnectionSS` j
.SSj k
RemoteIpAddressSSk z
}SSz {
"SS{ |
)SS| }
;SS} ~
returnTT 

StatusCodeTT %
(TT% &
$numTT& )
,TT) *
newTT+ .
ResponseMessageTT/ >
(TT> ?
ResponseTypeTT? K
.TTK L
FAILEDTTL R
,TTR S
$str	TTT Ä
)
TTÄ Å
)
TTÅ Ç
;
TTÇ É
}UU 
elseVV 
{WW 
_loggerXX 
.XX 
LogInformationXX *
(XX* +
$"XX+ -
$strXX- K
{XXK L
RequestXXL S
.XXS T
HttpContextXXT _
.XX_ `

ConnectionXX` j
.XXj k
RemoteIpAddressXXk z
}XXz {
"XX{ |
)XX| }
;XX} ~
returnYY 

StatusCodeYY %
(YY% &
$numYY& )
,YY) *
newYY+ .
ResponseMessageYY/ >
(YY> ?
ResponseTypeYY? K
.YYK L
FAILEDYYL R
,YYR S
$strYYT w
)YYw x
)YYx y
;YYy z
}ZZ 
}[[ 
catch\\ 
(\\ 
	Exception\\ 
e\\ 
)\\ 
{]] 
_logger^^ 
.^^ 
LogInformation^^ &
(^^& '
$"^^' )
$str^^) G
{^^G H
Request^^H O
.^^O P
HttpContext^^P [
.^^[ \

Connection^^\ f
.^^f g
RemoteIpAddress^^g v
}^^v w
"^^w x
)^^x y
;^^y z
return__ 

StatusCode__ !
(__! "
$num__" %
,__% &
new__' *
ResponseMessage__+ :
(__: ;
ResponseType__; G
.__G H
FAILED__H N
,__N O
$str	__P Å
)
__Å Ç
)
__Ç É
;
__É Ñ
}`` 
}aa 	
[cc 	
HttpPostcc	 
]cc 
[dd 	
Routedd	 
(dd 
$strdd 
)dd 
]dd 
publicee 
IActionResultee 
SendVerificationee -
(ee- .
[ee. /
FromBodyee/ 7
]ee7 8
Useree9 =
useree> B
)eeB C
{ff 	
_loggergg 
.gg 
LogInformationgg "
(gg" #
$"gg# %
$strgg% =
{gg= >
Requestgg> E
.ggE F
HttpContextggF Q
.ggQ R

ConnectionggR \
.gg\ ]
RemoteIpAddressgg] l
}ggl m
"ggm n
)ggn o
;ggo p
tryhh 
{ii 
Userjj 
fetchedUserjj  
=jj! "
_repojj# (
.jj( )
SendVerificationjj) 9
(jj9 :
userjj: >
)jj> ?
;jj? @
ifkk 
(kk 
!kk 
fetchedUserkk  
.kk  !
Verifiedkk! )
)kk) *
{ll 
returnmm 
Okmm 
(mm 
newmm !
ResponseMessagemm" 1
(mm1 2
ResponseTypemm2 >
.mm> ?
SUCCESSmm? F
,mmF G
$strmmH a
)mma b
)mmb c
;mmc d
}nn 
elseoo 
{pp 
returnqq 

StatusCodeqq %
(qq% &
$numqq& )
,qq) *
newqq+ .
ResponseMessageqq/ >
(qq> ?
ResponseTypeqq? K
.qqK L
FAILEDqqL R
,qqR S
$strqqT n
)qqn o
)qqo p
;qqp q
}rr 
}ss 
catchtt 
{uu 
returnvv 

StatusCodevv !
(vv! "
$numvv" %
,vv% &
newvv' *
ResponseMessagevv+ :
(vv: ;
ResponseTypevv; G
.vvG H
FAILEDvvH N
,vvN O
$str	vvP é
)
vvé è
)
vvè ê
;
vvê ë
}ww 
}xx 	
[zz 	
HttpGetzz	 
]zz 
[{{ 	
Route{{	 
({{ 
$str{{ +
){{+ ,
]{{, -
public|| 
IActionResult|| 
VerifyEmail|| (
(||( )
string||) /
confirmationToken||0 A
)||A B
{}} 	
_logger~~ 
.~~ 
LogInformation~~ "
(~~" #
$"~~# %
$str~~% C
{~~C D
Request~~D K
.~~K L
HttpContext~~L W
.~~W X

Connection~~X b
.~~b c
RemoteIpAddress~~c r
}~~r s
"~~s t
)~~t u
;~~u v
try 
{
ÄÄ 
bool
ÅÅ 
verified
ÅÅ 
=
ÅÅ 
_repo
ÅÅ  %
.
ÅÅ% &
VerifyEmail
ÅÅ& 1
(
ÅÅ1 2
confirmationToken
ÅÅ2 C
)
ÅÅC D
;
ÅÅD E
if
ÇÇ 
(
ÇÇ 
verified
ÇÇ 
)
ÇÇ 
{
ÉÉ 
return
ÑÑ 
Ok
ÑÑ 
(
ÑÑ 
new
ÑÑ !
ResponseMessage
ÑÑ" 1
(
ÑÑ1 2
ResponseType
ÑÑ2 >
.
ÑÑ> ?
SUCCESS
ÑÑ? F
,
ÑÑF G
$str
ÑÑH X
)
ÑÑX Y
)
ÑÑY Z
;
ÑÑZ [
}
ÖÖ 
else
ÜÜ 
{
áá 
return
àà 
Ok
àà 
(
àà 
new
àà !
ResponseMessage
àà" 1
(
àà1 2
ResponseType
àà2 >
.
àà> ?
FAILED
àà? E
,
ààE F
$str
ààG z
)
ààz {
)
àà{ |
;
àà| }
}
ââ 
}
ää 
catch
ãã 
{
åå 
return
çç 

StatusCode
çç !
(
çç! "
$num
çç" %
,
çç% &
new
çç' *
ResponseMessage
çç+ :
(
çç: ;
ResponseType
çç; G
.
ççG H
FAILED
ççH N
,
ççN O
$str
ççP x
)
ççx y
)
ççy z
;
ççz {
}
éé 
}
êê 	
[
íí 	
HttpGet
íí	 
]
íí 
[
ìì 	
Route
ìì	 
(
ìì 
$str
ìì 
)
ìì 
]
ìì 
public
îî 
IActionResult
îî 
VerifyUserSession
îî .
(
îî. /
)
îî/ 0
{
ïï 	
_logger
ññ 
.
ññ 
LogInformation
ññ "
(
ññ" #
$"
ññ# %
$str
ññ% >
{
ññ> ?
Request
ññ? F
.
ññF G
HttpContext
ññG R
.
ññR S

Connection
ññS ]
.
ññ] ^
RemoteIpAddress
ññ^ m
}
ññm n
"
ññn o
)
ñño p
;
ññp q
HttpContext
óó 
currentUser
óó #
=
óó$ %
HttpContext
óó& 1
;
óó1 2
bool
òò 
allowed
òò 
=
òò 
_authManager
òò '
.
òò' (
AuthoriseUser
òò( 5
(
òò5 6
currentUser
òò6 A
)
òòA B
;
òòB C
if
ôô 
(
ôô 
allowed
ôô 
)
ôô 
{
öö 
return
õõ 
Ok
õõ 
(
õõ 
new
õõ 
ResponseMessage
õõ -
(
õõ- .
ResponseType
õõ. :
.
õõ: ;
SUCCESS
õõ; B
,
õõB C
$str
õõD Z
)
õõZ [
)
õõ[ \
;
õõ\ ]
}
úú 
else
ùù 
{
ûû 
bool
üü 
auth
üü 
=
üü 
_authManager
üü (
.
üü( )
AuthoriseAdmin
üü) 7
(
üü7 8
currentUser
üü8 C
)
üüC D
;
üüD E
if
†† 
(
†† 
auth
†† 
)
†† 
{
°° 
return
¢¢ 
Ok
¢¢ 
(
¢¢ 
new
¢¢ !
ResponseMessage
¢¢" 1
(
¢¢1 2
ResponseType
¢¢2 >
.
¢¢> ?
SUCCESS
¢¢? F
,
¢¢F G
$str
¢¢H ^
)
¢¢^ _
)
¢¢_ `
;
¢¢` a
}
££ 
else
§§ 
{
•• 
return
¶¶ 

StatusCode
¶¶ %
(
¶¶% &
$num
¶¶& )
,
¶¶) *
new
¶¶+ .
ResponseMessage
¶¶/ >
(
¶¶> ?
ResponseType
¶¶? K
.
¶¶K L
FAILED
¶¶L R
,
¶¶R S
$str
¶¶T g
)
¶¶g h
)
¶¶h i
;
¶¶i j
}
ßß 
}
™™ 
}
´´ 	
[
≠≠ 	
HttpPost
≠≠	 
]
≠≠ 
[
ÆÆ 	
Route
ÆÆ	 
(
ÆÆ 
$str
ÆÆ 
)
ÆÆ  
]
ÆÆ  !
public
ØØ 
IActionResult
ØØ 
ForgotPassword
ØØ +
(
ØØ+ ,
[
ØØ, -
FromBody
ØØ- 5
]
ØØ5 6
User
ØØ7 ;
user
ØØ< @
)
ØØ@ A
{
∞∞ 	
_logger
±± 
.
±± 
LogInformation
±± "
(
±±" #
$"
±±# %
$str
±±% E
{
±±E F
Request
±±F M
.
±±M N
HttpContext
±±N Y
.
±±Y Z

Connection
±±Z d
.
±±d e
RemoteIpAddress
±±e t
}
±±t u
"
±±u v
)
±±v w
;
±±w x
try
≤≤ 
{
≥≥ 
User
¥¥ 
result
¥¥ 
=
¥¥ 
_repo
¥¥ #
.
¥¥# $
ForgotPassword
¥¥$ 2
(
¥¥2 3
user
¥¥3 7
.
¥¥7 8
Email
¥¥8 =
)
¥¥= >
;
¥¥> ?
return
µµ 
Ok
µµ 
(
µµ 
new
µµ 
ResponseMessage
µµ -
(
µµ- .
ResponseType
µµ. :
.
µµ: ;
SUCCESS
µµ; B
,
µµB C
$strµµD ™
)µµ™ ´
)µµ´ ¨
;µµ¨ ≠
}
∂∂ 
catch
∑∑ 
{
∏∏ 
return
ππ 

StatusCode
ππ !
(
ππ! "
$num
ππ" %
,
ππ% &
new
ππ' *
ResponseMessage
ππ+ :
(
ππ: ;
ResponseType
ππ; G
.
ππG H
FAILED
ππH N
,
ππN O
$str
ππP x
)
ππx y
)
ππy z
;
ππz {
}
∫∫ 
}
ªª 	
[
ΩΩ 	
HttpPost
ΩΩ	 
]
ΩΩ 
[
ææ 	
Route
ææ	 
(
ææ 
$str
ææ $
)
ææ$ %
]
ææ% &
public
øø 
IActionResult
øø 
ResetPassword
øø *
(
øø* +
string
øø+ 1
confirmationToken
øø2 C
,
øøC D
[
øøE F
FromBody
øøF N
]
øøN O
User
øøP T
user
øøU Y
)
øøY Z
{
¿¿ 	
_logger
¡¡ 
.
¡¡ 
LogInformation
¡¡ "
(
¡¡" #
$"
¡¡# %
$str
¡¡% D
{
¡¡D E
Request
¡¡E L
.
¡¡L M
HttpContext
¡¡M X
.
¡¡X Y

Connection
¡¡Y c
.
¡¡c d
RemoteIpAddress
¡¡d s
}
¡¡s t
"
¡¡t u
)
¡¡u v
;
¡¡v w
try
¬¬ 
{
√√ 
string
ƒƒ 
result
ƒƒ 
=
ƒƒ 
_repo
ƒƒ  %
.
ƒƒ% &
ResetPassword
ƒƒ& 3
(
ƒƒ3 4
confirmationToken
ƒƒ4 E
,
ƒƒE F
user
ƒƒG K
.
ƒƒK L
Password
ƒƒL T
)
ƒƒT U
;
ƒƒU V
if
≈≈ 
(
≈≈ 
result
≈≈ 
.
≈≈ 
Equals
≈≈ !
(
≈≈! "
$str
≈≈" +
)
≈≈+ ,
)
≈≈, -
{
∆∆ 
return
«« 
Ok
«« 
(
«« 
new
«« !
ResponseMessage
««" 1
(
««1 2
ResponseType
««2 >
.
««> ?
SUCCESS
««? F
,
««F G
$str
««H X
)
««X Y
)
««Y Z
;
««Z [
}
»» 
else
…… 
{
   
return
ÀÀ 

StatusCode
ÀÀ %
(
ÀÀ% &
$num
ÀÀ& )
,
ÀÀ) *
new
ÀÀ+ .
ResponseMessage
ÀÀ/ >
(
ÀÀ> ?
ResponseType
ÀÀ? K
.
ÀÀK L
SUCCESS
ÀÀL S
,
ÀÀS T
result
ÀÀU [
)
ÀÀ[ \
)
ÀÀ\ ]
;
ÀÀ] ^
}
ÃÃ 
}
ÕÕ 
catch
ŒŒ 
{
œœ 
return
–– 

StatusCode
–– !
(
––! "
$num
––" %
,
––% &
new
––' *
ResponseMessage
––+ :
(
––: ;
ResponseType
––; G
.
––G H
FAILED
––H N
,
––N O
$str
––P x
)
––x y
)
––y z
;
––z {
}
—— 
}
““ 	
}
”” 
}‘‘ ©
eE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Models\DatabaseCredentials.cs
	namespace 	
aspnet_web_api
 
. 
Models 
{ 
public 

class 
DatabaseCredentials $
{ 
public 
string 
Server 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Database 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
}		 
}

 á

WE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Models\Email.cs
	namespace 	
aspnet_web_api
 
. 
Models 
{ 
public 

class 
Email 
{		 
public

 
string

 
To

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
public 
string 
Subject 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Body 
{ 
get  
;  !
set" %
;% &
}' (
public 
Email 
( 
string 
to 
, 
string  &
subject' .
,. /
string0 6
body7 ;
); <
{ 	
To 
= 
to 
; 
Subject 
= 
subject 
; 
Body 
= 
body 
; 
} 	
public 
Email 
( 
) 
{ 	
} 	
} 
} ä
cE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Models\GoogleOAuthResult.cs
	namespace 	
aspnet_web_api
 
. 
Models 
{ 
public 

class 
GoogleOAuthResult "
{		 
public

 
string

 
Email

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
bool 
ValidationResult $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
} Œ
bE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Models\GoogleOAuthToken.cs
	namespace 	
aspnet_web_api
 
. 
Models 
{ 
public 

class 
GoogleOAuthToken !
{		 
public

 
string

 
token

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
} 
} É
YE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Models\Product.cs
	namespace 	
aspnet_web_api
 
. 
Models 
{ 
public 

class 
Product 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
int 
Price 
{ 
get 
; 
set  #
;# $
}% &
}		 
}

 ë
aE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Models\ResponseMessage.cs
	namespace 	
aspnet_web_api
 
. 
Models 
{ 
public 

class 
ResponseMessage  
{		 
public

 
ResponseType

 
Status

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
public 
string 
Message 
{ 
get  #
;# $
set% (
;( )
}* +
public 
ResponseMessage 
( 
ResponseType +
status, 2
,2 3
string4 :
message; B
)B C
{ 	
this 
. 
Status 
= 
status  
;  !
this 
. 
Message 
= 
message "
;" #
} 	
} 
} ‰
^E:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Models\ResponseType.cs
	namespace 	
aspnet_web_api
 
. 
Models 
{ 
public 

enum 
ResponseType 
{		 
SUCCESS

 
,

 
FAILED 
} 
} ã
VE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Models\User.cs
	namespace 	
aspnet_web_api
 
. 
Models 
{ 
public 

class 
User 
{		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Salt 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
public 
bool 
Verified 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
ConfirmationToken '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
DateTime 
	ResetDate !
{" #
get$ '
;' (
set) ,
;, -
}. /
} 
} Æ
_E:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Models\UserViewModel.cs
	namespace 	
aspnet_web_api
 
. 
Models 
{ 
public 

class 
UserViewModel 
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Token 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
public		 
bool		 
Verified		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
public 
UserViewModel 
( 
string #
name$ (
,( )
string* 0
email1 6
,6 7
string8 >
role? C
)C D
{ 	
Name 
= 
name 
; 
Email 
= 
email 
; 
Role 
= 
role 
; 
} 	
public 
UserViewModel 
( 
string #
name$ (
,( )
string* 0
email1 6
,6 7
string8 >
role? C
,C D
boolE I
verifiedJ R
,R S
stringT Z
token[ `
)` a
{ 	
Name 
= 
name 
; 
Email 
= 
email 
; 
Token 
= 
token 
; 
Verified 
= 
verified 
;  
Role 
= 
role 
; 
} 	
} 
} Û
RE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Program.cs
	namespace 	
aspnet_web_api
 
{ 
public 

class 
Program 
{		 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
DatabaseManager 
manager #
=$ %
new& )
DatabaseManager* 9
(9 :
$str: Y
)Y Z
;Z [
bool 
isAlive 
= 
manager "
." #
Connect# *
(* +
)+ ,
;, -
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 
UseUrls &
(& '
$str' =
)= >
;> ?

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ˆ*
jE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Repository\GoogleUserRepository.cs
	namespace 	
aspnet_web_api
 
. 

Repository #
{		 
public

 

class

  
GoogleUserRepository

 %
{ 
private 
GoogleUserContext !
_context" *
;* +
private 

JWTManager 
_jwtManager &
;& '
private 
GoogleOAuthHelper !
_authHelper" -
;- .
public  
GoogleUserRepository #
(# $
IConfiguration$ 2
config3 9
)9 :
{ 	
_jwtManager 
= 
new 

JWTManager (
(( )
config) /
)/ 0
;0 1
_context 
= 
new 
GoogleUserContext ,
(, -
)- .
;. /
_authHelper 
= 
new 
GoogleOAuthHelper /
(/ 0
)0 1
;1 2
} 	
public 
UserViewModel 

GetByEmail '
(' (
string( .
email/ 4
)4 5
{ 	
User 
user 
= 
_context  
.  !

GetByEmail! +
(+ ,
email, 1
)1 2
;2 3
return 
new 
UserViewModel $
($ %
user% )
.) *
Name* .
,. /
user0 4
.4 5
Email5 :
,: ;
user< @
.@ A
RoleA E
)E F
;F G
} 	
public 
UserViewModel 
	CreateNew &
(& '
User' +
user, 0
)0 1
{ 	
user 
. 
Role 
= 
$str "
;" #
User 
createdUser 
= 
_context '
.' (
	CreateNew( 1
(1 2
user2 6
)6 7
;7 8
return   
new   
UserViewModel   $
(  $ %
createdUser  % 0
.  0 1
Name  1 5
,  5 6
createdUser  7 B
.  B C
Email  C H
,  H I
user  J N
.  N O
Role  O S
)  S T
;  T U
}"" 	
public$$ 
UserViewModel$$ 
Authenticate$$ )
($$) *
string$$* 0
tokenId$$1 8
)$$8 9
{%% 	
GoogleOAuthResult&& 
result&& $
=&&% &
_authHelper&&' 2
.&&2 3
ValidateToken&&3 @
(&&@ A
tokenId&&A H
)&&H I
.&&I J
Result&&J P
;&&P Q
if'' 
('' 
result'' 
.'' 
ValidationResult'' '
)''' (
{(( 
User)) 
fetchedUser))  
=))! "
_context))# +
.))+ ,

GetByEmail)), 6
())6 7
result))7 =
.))= >
Email))> C
)))C D
;))D E
if** 
(** 
fetchedUser** 
!=**  "
null**# '
)**' (
{++ 
string,, 
token,,  
=,,! "
_jwtManager,,# .
.,,. / 
GenerateJSONWebToken,,/ C
(,,C D
fetchedUser,,D O
),,O P
;,,P Q
return-- 
new-- 
UserViewModel-- ,
(--, -
fetchedUser--- 8
.--8 9
Name--9 =
,--= >
fetchedUser--? J
.--J K
Email--K P
,--P Q
fetchedUser--R ]
.--] ^
Role--^ b
,--b c
fetchedUser--d o
.--o p
Verified--p x
,--x y
token--z 
)	-- Ä
;
--Ä Å
}.. 
else// 
{00 
User11 
user11 
=11 
new11  #
User11$ (
(11( )
)11) *
;11* +
user22 
.22 
Email22 
=22  
result22! '
.22' (
Email22( -
;22- .
user33 
.33 
Name33 
=33 
result33  &
.33& '
Name33' +
;33+ ,
UserViewModel44 !
createdUser44" -
=44. /
	CreateNew440 9
(449 :
user44: >
)44> ?
;44? @
if55 
(55 
createdUser55 #
!=55$ &
null55' +
)55+ ,
{66 
string77 
token77 $
=77% &
_jwtManager77' 2
.772 3 
GenerateJSONWebToken773 G
(77G H
fetchedUser77H S
)77S T
;77T U
return88 
new88 "
UserViewModel88# 0
(880 1
createdUser881 <
.88< =
Email88= B
,88B C
createdUser88D O
.88O P
Name88P T
,88T U
token88V [
)88[ \
;88\ ]
}99 
else:: 
{;; 
return<< 
null<< #
;<<# $
}== 
}?? 
}@@ 
elseAA 
{BB 
returnCC 
nullCC 
;CC 
}DD 
}FF 	
}GG 
}HH é
gE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Repository\ProductRepository.cs
	namespace 	
aspnet_web_api
 
. 

Repository #
{ 
public 

class 
ProductRepository "
{		 
ProductContext

 
context

 
;

 
public 
ProductRepository  
(  !
)! "
{ 	
context 
= 
new 
ProductContext (
(( )
)) *
;* +
} 	
public 
List 
< 
Product 
> 
GetAll #
(# $
)$ %
{ 	
return 
context 
. 
GetAll !
(! "
)" #
;# $
} 	
} 
} ÆÄ
dE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Repository\UserRepository.cs
	namespace 	
aspnet_web_api
 
. 

Repository #
{		 
public

 

class

 
UserRepository

 
{ 
private 
UserContext 
_context $
;$ %
private 

JWTManager 
_jwtManager &
;& '
private 
UserInputValidator "

_validator# -
;- .
private 

HashHelper 
_hashHelper &
;& '
private 

GoogleSTMP 
_emailService (
;( )
public 
UserRepository 
( 
IConfiguration ,
config- 3
)3 4
{ 	
_jwtManager 
= 
new 

JWTManager (
(( )
config) /
)/ 0
;0 1
_context 
= 
new 
UserContext &
(& '
)' (
;( )

_validator 
= 
new 
UserInputValidator /
(/ 0
)0 1
;1 2
_hashHelper 
= 
new 

HashHelper (
(( )
)) *
;* +
_emailService 
= 
new 

GoogleSTMP  *
(* +
)+ ,
;, -
} 	
public 
UserViewModel 

GetByEmail '
(' (
string( .
email/ 4
)4 5
{ 	
User 
user 
= 
_context  
.  !

GetByEmail! +
(+ ,
email, 1
)1 2
;2 3
if 
( 
user 
!= 
null 
) 
{ 
return 
new 
UserViewModel (
(( )
user) -
.- .
Name. 2
,2 3
user4 8
.8 9
Email9 >
,> ?
user@ D
.D E
RoleE I
)I J
;J K
}   
else!! 
{"" 
return## 
null## 
;## 
}$$ 
}%% 	
public'' 
string'' 
	CreateNew'' 
(''  
User''  $
user''% )
)'') *
{(( 	
Random)) 
random)) 
=)) 
new)) 
Random))  &
())& '
)))' (
;))( )
int** 
length** 
=** 
$num** 
;** 
user++ 
.++ 
Role++ 
=++ 
$str++ "
;++" #
string,, 
result,, 
;,, 
try.. 
{// 
const00 
string00 
chars00 "
=00# $
$str00% e
;00e f
user11 
.11 
ConfirmationToken11 &
=11' (
new11) ,
string11- 3
(113 4

Enumerable114 >
.11> ?
Repeat11? E
(11E F
chars11F K
,11K L
length11M S
)11S T
.11T U
Select11U [
(11[ \
s11\ ]
=>11^ `
s11a b
[11b c
random11c i
.11i j
Next11j n
(11n o
s11o p
.11p q
Length11q w
)11w x
]11x y
)11y z
.11z {
ToArray	11{ Ç
(
11Ç É
)
11É Ñ
)
11Ñ Ö
;
11Ö Ü
result22 
=22 

_validator22 #
.22# $%
ValidateRegistrationInput22$ =
(22= >
user22> B
)22B C
;22C D
string33 
salt33 
=33 
_hashHelper33 )
.33) *
GenerateSalt33* 6
(336 7
)337 8
;338 9
string44 
hash44 
=44 
_hashHelper44 )
.44) *
HashPassword44* 6
(446 7
user447 ;
.44; <
Password44< D
,44D E
salt44F J
)44J K
;44K L
user55 
.55 
Password55 
=55 
hash55  $
;55$ %
user66 
.66 
Salt66 
=66 
salt66  
;66  !
user77 
.77 
Email77 
.77 
ToLower77 "
(77" #
)77# $
;77$ %
}88 
catch99 
{:: 
return;; 
$str;; $
;;;$ %
}<< 
if== 
(== 
result== 
.== 
Equals== 
(== 
$str== '
)==' (
)==( )
{>> 
bool?? 
fetch?? 
=?? 
_context?? %
.??% &
	CreateNew??& /
(??/ 0
user??0 4
)??4 5
;??5 6
if@@ 
(@@ 
!@@ 
fetch@@ 
)@@ 
{AA 
returnBB 
$strBB b
;BBb c
}CC 
}DD 
returnEE 
resultEE 
;EE 
}FF 	
publicHH 
UserViewModelHH 
LoginHH "
(HH" #
UserHH# '
userHH( ,
)HH, -
{II 	
UserJJ 
fetchedUserJJ 
=JJ 
_contextJJ '
.JJ' (

GetByEmailJJ( 2
(JJ2 3
userJJ3 7
.JJ7 8
EmailJJ8 =
)JJ= >
;JJ> ?
ifKK 
(KK 
fetchedUserKK 
!=KK 
nullKK #
)KK# $
{LL 
stringMM 
passwordHashMM #
=MM$ %
_hashHelperMM& 1
.MM1 2
HashPasswordMM2 >
(MM> ?
userMM? C
.MMC D
PasswordMMD L
,MML M
fetchedUserMMN Y
.MMY Z
SaltMMZ ^
)MM^ _
;MM_ `
ifNN 
(NN 
fetchedUserNN 
!=NN  "
nullNN# '
&&NN( *
fetchedUserNN+ 6
.NN6 7
EmailNN7 <
.NN< =
EqualsNN= C
(NNC D
userNND H
.NNH I
EmailNNI N
.NNN O
ToLowerNNO V
(NNV W
)NNW X
)NNX Y
&&NNZ \
fetchedUserNN] h
.NNh i
PasswordNNi q
.NNq r
EqualsNNr x
(NNx y
passwordHash	NNy Ö
)
NNÖ Ü
)
NNÜ á
{OO 
stringPP 
tokenPP  
=PP! "
_jwtManagerPP# .
.PP. / 
GenerateJSONWebTokenPP/ C
(PPC D
fetchedUserPPD O
)PPO P
;PPP Q
returnQQ 
newQQ 
UserViewModelQQ ,
(QQ, -
fetchedUserQQ- 8
.QQ8 9
NameQQ9 =
,QQ= >
fetchedUserQQ? J
.QQJ K
EmailQQK P
,QQP Q
fetchedUserQQR ]
.QQ] ^
RoleQQ^ b
,QQb c
fetchedUserQQd o
.QQo p
VerifiedQQp x
,QQx y
tokenQQz 
)	QQ Ä
;
QQÄ Å
}RR 
elseSS 
{TT 
returnUU 
nullUU 
;UU  
}VV 
}WW 
elseXX 
{YY 
returnZZ 
nullZZ 
;ZZ 
}[[ 
}]] 	
public__ 
User__ 
SendVerification__ $
(__$ %
User__% )
user__* .
)__. /
{`` 	
Userbb 
fetchedUserbb 
=bb 
_contextbb '
.bb' (

GetByEmailbb( 2
(bb2 3
userbb3 7
.bb7 8
Emailbb8 =
)bb= >
;bb> ?
ifcc 
(cc 
!cc 
fetchedUsercc 
.cc 
Verifiedcc %
)cc% &
{dd 
Emailff 
mailff 
=ff 
newff  
Emailff! &
(ff& '
$strff' C
,ffC D
$strffE \
,ff\ ]
$"ff^ `
$strff` g
{ffg h
fetchedUserffh s
.ffs t
Namefft x
}ffx y
$str	ffy …
{
ff…  
fetchedUser
ff  ’
.
ff’ ÷
ConfirmationToken
ff÷ Á
}
ffÁ Ë
"
ffË È
)
ffÈ Í
;
ffÍ Î
trygg 
{hh 
_emailServiceii !
.ii! "
	SendEmailii" +
(ii+ ,
mailii, 0
)ii0 1
;ii1 2
returnjj 
fetchedUserjj &
;jj& '
}kk 
catchll 
{mm 
returnnn 
nullnn 
;nn  
}oo 
}pp 
elseqq 
{rr 
returnss 
fetchedUserss "
;ss" #
}tt 
}vv 	
publicyy 
boolyy 
VerifyEmailyy 
(yy  
stringyy  &
confirmationTokenyy' 8
)yy8 9
{zz 	
bool{{ 
verified{{ 
={{ 
_context{{ $
.{{$ %
VerifyEmail{{% 0
({{0 1
confirmationToken{{1 B
){{B C
;{{C D
if}} 
(}} 
verified}} 
)}} 
{~~ 
return 
true 
; 
}
ÄÄ 
else
ÅÅ 
{
ÇÇ 
return
ÉÉ 
false
ÉÉ 
;
ÉÉ 
}
ÑÑ 
}
ÖÖ 	
public
áá 
User
áá 
ForgotPassword
áá "
(
áá" #
string
áá# )
email
áá* /
)
áá/ 0
{
àà 	
User
ââ 
fetchedUser
ââ 
=
ââ 
_context
ââ '
.
ââ' (

GetByEmail
ââ( 2
(
ââ2 3
email
ââ3 8
)
ââ8 9
;
ââ9 :
Random
ää 
random
ää 
=
ää 
new
ää 
Random
ää  &
(
ää& '
)
ää' (
;
ää( )
int
ãã 
length
ãã 
=
ãã 
$num
ãã 
;
ãã 
if
åå 
(
åå 
fetchedUser
åå 
!=
åå 
null
åå #
)
åå# $
{
çç 
if
éé 
(
éé 
fetchedUser
éé 
.
éé  
Verified
éé  (
)
éé( )
{
èè 
const
êê 
string
êê  
chars
êê! &
=
êê' (
$str
êê) i
;
êêi j
fetchedUser
ëë 
.
ëë  
ConfirmationToken
ëë  1
=
ëë2 3
new
ëë4 7
string
ëë8 >
(
ëë> ?

Enumerable
ëë? I
.
ëëI J
Repeat
ëëJ P
(
ëëP Q
chars
ëëQ V
,
ëëV W
length
ëëX ^
)
ëë^ _
.
ëë_ `
Select
ëë` f
(
ëëf g
s
ëëg h
=>
ëëi k
s
ëël m
[
ëëm n
random
ëën t
.
ëët u
Next
ëëu y
(
ëëy z
s
ëëz {
.
ëë{ |
Lengthëë| Ç
)ëëÇ É
]ëëÉ Ñ
)ëëÑ Ö
.ëëÖ Ü
ToArrayëëÜ ç
(ëëç é
)ëëé è
)ëëè ê
;ëëê ë
fetchedUser
íí 
.
íí  
	ResetDate
íí  )
=
íí* +
DateTime
íí, 4
.
íí4 5
Now
íí5 8
;
íí8 9
bool
ìì 
result
ìì 
=
ìì  !
_context
ìì" *
.
ìì* +

UpdateUser
ìì+ 5
(
ìì5 6
fetchedUser
ìì6 A
)
ììA B
;
ììB C
if
ïï 
(
ïï 
result
ïï 
)
ïï 
{
ññ 
Email
óó 
mail
óó "
=
óó# $
new
óó% (
Email
óó) .
(
óó. /
$str
óó/ K
,
óóK L
$str
óóM h
,
óóh i
$"
óój l
$str
óól s
{
óós t
fetchedUser
óót 
.óó Ä
NameóóÄ Ñ
}óóÑ Ö
$stróóÖ ”
{óó” ‘
fetchedUseróó‘ ﬂ
.óóﬂ ‡!
ConfirmationTokenóó‡ Ò
}óóÒ Ú
"óóÚ Û
)óóÛ Ù
;óóÙ ı
_emailService
òò %
.
òò% &
	SendEmail
òò& /
(
òò/ 0
mail
òò0 4
)
òò4 5
;
òò5 6
return
ôô 
fetchedUser
ôô *
;
ôô* +
}
öö 
else
õõ 
{
úú 
return
ùù 
null
ùù #
;
ùù# $
}
ûû 
}
†† 
else
°° 
{
¢¢ 
return
££ 
null
££ 
;
££  
}
§§ 
}
•• 
else
¶¶ 
{
ßß 
return
®® 
null
®® 
;
®® 
}
©© 
}
´´ 	
public
≠≠ 
string
≠≠ 
ResetPassword
≠≠ #
(
≠≠# $
string
≠≠$ *
confirmationToken
≠≠+ <
,
≠≠< =
string
≠≠> D
password
≠≠E M
)
≠≠M N
{
ÆÆ 	
User
ØØ 
result
ØØ 
=
ØØ 
_context
ØØ "
.
ØØ" #
GetByConfirmToken
ØØ# 4
(
ØØ4 5
confirmationToken
ØØ5 F
)
ØØF G
;
ØØG H
string
∞∞ 
failed
∞∞ 
=
∞∞ 
$str
∞∞ H
;
∞∞H I
if
±± 
(
±± 
result
±± 
!=
±± 
null
±± 
)
±± 
{
≤≤ 
DateTime
≥≥ 
now
≥≥ 
=
≥≥ 
DateTime
≥≥ '
.
≥≥' (
Now
≥≥( +
;
≥≥+ ,
TimeSpan
¥¥ 
interval
¥¥ !
=
¥¥" #
now
¥¥$ '
-
¥¥( )
result
¥¥* 0
.
¥¥0 1
	ResetDate
¥¥1 :
.
¥¥: ;
ToLocalTime
¥¥; F
(
¥¥F G
)
¥¥G H
;
¥¥H I
int
µµ 

expiration
µµ 
=
µµ  
$num
µµ! "
;
µµ" #
if
∑∑ 
(
∑∑ 
interval
∑∑ 
.
∑∑ 
TotalMinutes
∑∑ )
<
∑∑* +

expiration
∑∑, 6
)
∑∑6 7
{
∏∏ 
try
ππ 
{
∫∫ 
string
ªª 
passwordResult
ªª -
=
ªª. /

_validator
ªª0 :
.
ªª: ;#
CheckPasswordStrength
ªª; P
(
ªªP Q
password
ªªQ Y
)
ªªY Z
;
ªªZ [
if
ºº 
(
ºº 
passwordResult
ºº )
.
ºº) *
Equals
ºº* 0
(
ºº0 1
$str
ºº1 :
)
ºº: ;
)
ºº; <
{
ΩΩ 
result
ææ "
.
ææ" #
Password
ææ# +
=
ææ, -
password
ææ. 6
;
ææ6 7
string
øø "
hash
øø# '
=
øø( )
_hashHelper
øø* 5
.
øø5 6
HashPassword
øø6 B
(
øøB C
result
øøC I
.
øøI J
Password
øøJ R
,
øøR S
result
øøT Z
.
øøZ [
Salt
øø[ _
)
øø_ `
;
øø` a
result
¿¿ "
.
¿¿" #
Password
¿¿# +
=
¿¿, -
hash
¿¿. 2
;
¿¿2 3
}
¡¡ 
else
¬¬ 
{
√√ 
return
ƒƒ "
passwordResult
ƒƒ# 1
;
ƒƒ1 2
}
≈≈ 
}
«« 
catch
»» 
{
…… 
return
   
$str
   ,
;
  , -
}
ÀÀ 
bool
ÃÃ 
updated
ÃÃ  
=
ÃÃ! "
_context
ÃÃ# +
.
ÃÃ+ ,

UpdateUser
ÃÃ, 6
(
ÃÃ6 7
result
ÃÃ7 =
)
ÃÃ= >
;
ÃÃ> ?
if
ŒŒ 
(
ŒŒ 
updated
ŒŒ 
)
ŒŒ 
{
œœ 
return
–– 
$str
–– (
;
––( )
}
—— 
else
““ 
{
”” 
return
‘‘ 
failed
‘‘ %
;
‘‘% &
}
’’ 
}
◊◊ 
else
ÿÿ 
{
ŸŸ 
return
⁄⁄ 
failed
⁄⁄ !
;
⁄⁄! "
}
€€ 
}
‹‹ 
else
›› 
{
ﬁﬁ 
return
ﬂﬂ 
failed
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
}
·· 	
}
‚‚ 
}„„ ’;
RE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Startup.cs
	namespace 	
aspnet_web_api
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
	Configure 
< #
ForwardedHeadersOptions 6
>6 7
(7 8
options8 ?
=>@ B
{ 
options   
.   
KnownProxies   $
.  $ %
Add  % (
(  ( )
	IPAddress  ) 2
.  2 3
Parse  3 8
(  8 9
$str  9 E
)  E F
)  F G
;  G H
options!! 
.!! 
KnownProxies!! $
.!!$ %
Add!!% (
(!!( )
	IPAddress!!) 2
.!!2 3
Parse!!3 8
(!!8 9
$str!!9 E
)!!E F
)!!F G
;!!G H
options"" 
."" 
KnownProxies"" $
.""$ %
Add""% (
(""( )
	IPAddress"") 2
.""2 3
Parse""3 8
(""8 9
$str""9 F
)""F G
)""G H
;""H I
}## 
)## 
;## 
services%% 
.%% 
AddControllers%% #
(%%# $
)%%$ %
;%%% &
services&& 
.&& 
AddCors&& 
(&& 
)&& 
;&& 
services'' 
.'' 
AddAuthentication'' &
(''& '
JwtBearerDefaults''' 8
.''8 9 
AuthenticationScheme''9 M
)''M N
.''N O
AddJwtBearer''O [
(''[ \
options''\ c
=>''d f
{(( 
options)) 
.)) %
TokenValidationParameters)) 1
=))2 3
new))4 7%
TokenValidationParameters))8 Q
{** 
ValidateIssuer++ "
=++# $
true++% )
,++) *
ValidateAudience,, $
=,,% &
true,,' +
,,,+ ,
ValidateLifetime-- $
=--% &
true--' +
,--+ ,$
ValidateIssuerSigningKey.. ,
=..- .
true../ 3
,..3 4
ValidIssuer// 
=//  !
Configuration//" /
[/// 0
$str//0 <
]//< =
,//= >
ValidAudience00 !
=00" #
Configuration00$ 1
[001 2
$str002 >
]00> ?
,00? @
IssuerSigningKey11 $
=11% &
new11' * 
SymmetricSecurityKey11+ ?
(11? @
Encoding11@ H
.11H I
UTF811I M
.11M N
GetBytes11N V
(11V W
Configuration11W d
[11d e
$str11e n
]11n o
)11o p
)11p q
}22 
;22 
}33 
)33 
;33 
services55 
.55 
AddMemoryCache55 #
(55# $
)55$ %
;55% &
services88 
.88 
	Configure88 
<88 
IpRateLimitOptions88 1
>881 2
(882 3
Configuration883 @
.88@ A

GetSection88A K
(88K L
$str88L \
)88\ ]
)88] ^
;88^ _
services;; 
.;; 
AddSingleton;; !
<;;! "
IIpPolicyStore;;" 0
,;;0 1$
MemoryCacheIpPolicyStore;;2 J
>;;J K
(;;K L
);;L M
;;;M N
services<< 
.<< 
AddSingleton<< !
<<<! ""
IRateLimitCounterStore<<" 8
,<<8 9,
 MemoryCacheRateLimitCounterStore<<: Z
><<Z [
(<<[ \
)<<\ ]
;<<] ^
services== 
.== 
AddSingleton== !
<==! "
IProcessingStrategy==" 5
,==5 6*
AsyncKeyLockProcessingStrategy==7 U
>==U V
(==V W
)==W X
;==X Y
servicesAA 
.AA 
AddSingletonAA !
<AA! " 
IHttpContextAccessorAA" 6
,AA6 7
HttpContextAccessorAA8 K
>AAK L
(AAL M
)AAM N
;AAN O
servicesDD 
.DD 
AddSingletonDD !
<DD! "#
IRateLimitConfigurationDD" 9
,DD9 :"
RateLimitConfigurationDD; Q
>DDQ R
(DDR S
)DDS T
;DDT U
servicesEE 
.EE 

AddOptionsEE 
(EE  
)EE  !
;EE! "
}HH 	
publicKK 
voidKK 
	ConfigureKK 
(KK 
IApplicationBuilderKK 1
appKK2 5
,KK5 6
IWebHostEnvironmentKK7 J
envKKK N
,KKN O
ILoggerFactoryKKP ^
loggerFactoryKK_ l
)KKl m
{LL 	
appNN 
.NN 
UseIpRateLimitingNN !
(NN! "
)NN" #
;NN# $
ifOO 
(OO 
envOO 
.OO 
IsDevelopmentOO !
(OO! "
)OO" #
)OO# $
{PP 
appQQ 
.QQ %
UseDeveloperExceptionPageQQ -
(QQ- .
)QQ. /
;QQ/ 0
}RR 
appTT 
.TT 
UseForwardedHeadersTT #
(TT# $
newTT$ '#
ForwardedHeadersOptionsTT( ?
{UU 
ForwardedHeadersVV  
=VV! "
ForwardedHeadersVV# 3
.VV3 4
XForwardedForVV4 A
|VVB C
ForwardedHeadersVVD T
.VVT U
XForwardedProtoVVU d
}WW 
)WW 
;WW 
varZZ 
pathZZ 
=ZZ 
	DirectoryZZ  
.ZZ  !
GetCurrentDirectoryZZ! 4
(ZZ4 5
)ZZ5 6
;ZZ6 7
loggerFactory[[ 
.[[ 
AddFile[[ !
([[! "
$str[[" 3
)[[3 4
;[[4 5
app]] 
.]] 
UseCors]] 
(]] 
x]] 
=>]] 
x]] 
.^^ 
AllowAnyMethod^^ 
(^^ 
)^^ 
.__ 
AllowAnyHeader__ 
(__ 
)__ 
.`` 
SetIsOriginAllowed`` 
(``  
origin``  &
=>``' )
true``* .
)``. /
.aa 
AllowCredentialsaa 
(aa 
)aa 
)aa  
;aa  !
appdd 
.dd 
UseHttpsRedirectiondd #
(dd# $
)dd$ %
;dd% &
appff 
.ff 

UseRoutingff 
(ff 
)ff 
;ff 
apphh 
.hh 
UseAuthenticationhh !
(hh! "
)hh" #
;hh# $
appjj 
.jj 
UseAuthorizationjj  
(jj  !
)jj! "
;jj" #
appll 
.ll 
UseEndpointsll 
(ll 
	endpointsll &
=>ll' )
{mm 
	endpointsnn 
.nn 
MapControllersnn (
(nn( )
)nn) *
;nn* +
}oo 
)oo 
;oo 
}pp 	
}qq 
}rr “)
bE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Utility\DatabaseManager.cs
	namespace

 	
aspnet_web_api


 
.

 
Utility

  
{ 
public 

class 
DatabaseManager  
{ 
private 
string 

configPath !
;! "#
MySqlDatabaseConnection 
database  (
;( )
public 
DatabaseManager 
( 
string %

configPath& 0
)0 1
{ 	
this 
. 

configPath 
= 

configPath (
;( )
database 
= #
MySqlDatabaseConnection .
.. /
Instance/ 7
(7 8
)8 9
;9 :
} 	
public 
bool 
Connect 
( 
) 
{ 	
string 
json 
= 
File 
. 
ReadAllText *
(* +

configPath+ 5
)5 6
;6 7
DatabaseCredentials 
credentials  +
=, -
new. 1
DatabaseCredentials2 E
(E F
)F G
;G H
credentials 
= 
JsonSerializer (
.( )
Deserialize) 4
<4 5
DatabaseCredentials5 H
>H I
(I J
jsonJ N
)N O
;O P
database 
. 
Server 
= 
credentials )
.) *
Server* 0
;0 1
database 
. 
DatabaseName !
=" #
credentials$ /
./ 0
Database0 8
;8 9
database 
. 
UserName 
= 
credentials  +
.+ ,
Username, 4
;4 5
database 
. 
Password 
= 
credentials  +
.+ ,
Password, 4
;4 5
bool!! 
isOpen!! 
=!! 
database!! "
.!!" #
Open!!# '
(!!' (
)!!( )
;!!) *
return"" 
isOpen"" 
;"" 
}## 	
public%% 
	DataTable%% 
ExecuteQuery%% %
(%%% &
string%%& ,
sql%%- 0
,%%0 1
bool%%2 6

userParams%%7 A
,%%A B

Dictionary%%C M
<%%M N
string%%N T
,%%T U
string%%V \
>%%\ ]

dictionary%%^ h
=%%i j
null%%k o
)%%o p
{&& 	
	DataTable'' 
table'' 
='' 
new'' !
	DataTable''" +
(''+ ,
)'', -
;''- .
try)) 
{** 
MySqlCommand,, 
cmd,,  
=,,! "
new,,# &
MySqlCommand,,' 3
(,,3 4
),,4 5
;,,5 6
cmd-- 
.-- 

Connection-- 
=--  
database--! )
.--) *

Connection--* 4
;--4 5
cmd.. 
... 
CommandText.. 
=..  !
sql.." %
;..% &
if00 
(00 

userParams00 
==00 !
true00" &
)00& '
{11 
foreach22 
(22 
KeyValuePair22 )
<22) *
string22* 0
,220 1
string222 8
>228 9
kvp22: =
in22> @

dictionary22A K
)22K L
{33 
if44 
(44 
kvp44 
.44 
Key44 "
.44" #
Equals44# )
(44) *
$str44* 7
)447 8
)448 9
{55 
cmd66 
.66  

Parameters66  *
.66* +
AddWithValue66+ 7
(667 8
kvp668 ;
.66; <
Key66< ?
,66? @
double66A G
.66G H
Parse66H M
(66M N
kvp66N Q
.66Q R
Value66R W
)66W X
)66X Y
;66Y Z
}77 
else88 
{99 
cmd:: 
.::  

Parameters::  *
.::* +
AddWithValue::+ 7
(::7 8
kvp::8 ;
.::; <
Key::< ?
,::? @
kvp::A D
.::D E
Value::E J
)::J K
;::K L
};; 
}== 
cmd>> 
.>> 
Prepare>> 
(>>  
)>>  !
;>>! "
}?? 
MySqlDataReader@@ 
reader@@  &
=@@' (
cmd@@) ,
.@@, -
ExecuteReader@@- :
(@@: ;
)@@; <
;@@< =
tableAA 
.AA 
LoadAA 
(AA 
readerAA !
)AA! "
;AA" #
readerBB 
.BB 
CloseBB 
(BB 
)BB 
;BB 
returnCC 
tableCC 
;CC 
}EE 
catchFF 
(FF 
	ExceptionFF 
exFF 
)FF  
{GG 
returnHH 
nullHH 
;HH 
}II 
}JJ 	
}KK 
}LL ƒQ
eE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Utility\DataTableConverter.cs
	namespace 	
aspnet_web_api
 
. 
Utility  
{ 
public 

class 
DataTableConverter #
{		 
public

 
List

 
<

 
User

 
>

 
ConvertToUser

 '
(

' (
	DataTable

( 1
	dataTable

2 ;
)

; <
{ 	
List 
< 
User 
> 
users 
= 
new "
List# '
<' (
User( ,
>, -
(- .
). /
;/ 0
if 
( 
	dataTable 
!= 
null !
)! "
{ 
try 
{ 
for 
( 
int 
i 
=  
$num! "
;" #
i$ %
<& '
	dataTable( 1
.1 2
Rows2 6
.6 7
Count7 <
;< =
i> ?
++? A
)A B
{ 
User 
user !
=" #
new$ '
User( ,
(, -
)- .
;. /
user 
. 
Id 
=  !
Convert" )
.) *
ToInt32* 1
(1 2
	dataTable2 ;
.; <
Rows< @
[@ A
iA B
]B C
[C D
$strD H
]H I
)I J
;J K
user 
. 
Email "
=# $
	dataTable% .
.. /
Rows/ 3
[3 4
i4 5
]5 6
[6 7
$str7 >
]> ?
.? @
ToString@ H
(H I
)I J
;J K
user 
. 
Name !
=" #
	dataTable$ -
.- .
Rows. 2
[2 3
i3 4
]4 5
[5 6
$str6 <
]< =
.= >
ToString> F
(F G
)G H
;H I
user 
. 
Password %
=& '
	dataTable( 1
.1 2
Rows2 6
[6 7
i7 8
]8 9
[9 :
$str: D
]D E
.E F
ToStringF N
(N O
)O P
;P Q
user 
. 
Salt !
=" #
	dataTable$ -
.- .
Rows. 2
[2 3
i3 4
]4 5
[5 6
$str6 <
]< =
.= >
ToString> F
(F G
)G H
;H I
user 
. 
Role !
=" #
	dataTable$ -
.- .
Rows. 2
[2 3
i3 4
]4 5
[5 6
$str6 <
]< =
.= >
ToString> F
(F G
)G H
;H I
user 
. 
Verified %
=& '
(( )
bool) -
)- .
	dataTable/ 8
.8 9
Rows9 =
[= >
i> ?
]? @
[@ A
$strA K
]K L
;L M
user 
. 
ConfirmationToken .
=/ 0
	dataTable1 :
.: ;
Rows; ?
[? @
i@ A
]A B
[B C
$strC W
]W X
.X Y
ToStringY a
(a b
)b c
;c d
DateTime  

dtDateTime! +
=, -
new. 1
DateTime2 :
(: ;
$num; ?
,? @
$numA B
,B C
$numD E
,E F
$numG H
,H I
$numJ K
,K L
$numM N
,N O
$numP Q
,Q R
DateTimeKindS _
._ `
Local` e
)e f
;f g
double 
time #
=$ %
(& '
double' -
)- .
	dataTable. 7
.7 8
Rows8 <
[< =
i= >
]> ?
[? @
$str@ L
]L M
;M N
user 
. 
	ResetDate &
=' (

dtDateTime) 3
.3 4
AddMilliseconds4 C
(C D
timeD H
)H I
.I J
ToLocalTimeJ U
(U V
)V W
;W X
users 
. 
Add !
(! "
user" &
)& '
;' (
}   
}!! 
catch"" 
("" 
	Exception""  
e""! "
)""" #
{## 
return$$ 
null$$ 
;$$  
}%% 
}&& 
return'' 
users'' 
;'' 
}(( 	
public** 
List** 
<** 
User** 
>** 
ConvertToGoogleUser** -
(**- .
	DataTable**. 7
	dataTable**8 A
)**A B
{++ 	
List,, 
<,, 
User,, 
>,, 
users,, 
=,, 
new,, "
List,,# '
<,,' (
User,,( ,
>,,, -
(,,- .
),,. /
;,,/ 0
if-- 
(-- 
	dataTable-- 
!=-- 
null-- !
)--! "
{.. 
try// 
{00 
for11 
(11 
int11 
i11 
=11  
$num11! "
;11" #
i11$ %
<11& '
	dataTable11( 1
.111 2
Rows112 6
.116 7
Count117 <
;11< =
i11> ?
++11? A
)11A B
{22 
User33 
user33 !
=33" #
new33$ '
User33( ,
(33, -
)33- .
;33. /
user44 
.44 
Id44 
=44  !
Convert44" )
.44) *
ToInt3244* 1
(441 2
	dataTable442 ;
.44; <
Rows44< @
[44@ A
i44A B
]44B C
[44C D
$str44D H
]44H I
)44I J
;44J K
user55 
.55 
Email55 "
=55# $
	dataTable55% .
.55. /
Rows55/ 3
[553 4
i554 5
]555 6
[556 7
$str557 >
]55> ?
.55? @
ToString55@ H
(55H I
)55I J
;55J K
user66 
.66 
Name66 !
=66" #
	dataTable66$ -
.66- .
Rows66. 2
[662 3
i663 4
]664 5
[665 6
$str666 <
]66< =
.66= >
ToString66> F
(66F G
)66G H
;66H I
user77 
.77 
Role77 !
=77" #
	dataTable77$ -
.77- .
Rows77. 2
[772 3
i773 4
]774 5
[775 6
$str776 <
]77< =
.77= >
ToString77> F
(77F G
)77G H
;77H I
users88 
.88 
Add88 !
(88! "
user88" &
)88& '
;88' (
}99 
}:: 
catch;; 
(;; 
	Exception;;  
e;;! "
);;" #
{<< 
return== 
null== 
;==  
}>> 
}?? 
return@@ 
users@@ 
;@@ 
}AA 	
publicBB 
ListBB 
<BB 
ProductBB 
>BB 
ConvertToProductBB -
(BB- .
	DataTableBB. 7
	dataTableBB8 A
)BBA B
{CC 	
ListDD 
<DD 
ProductDD 
>DD 
productsDD "
=DD# $
newDD% (
ListDD) -
<DD- .
ProductDD. 5
>DD5 6
(DD6 7
)DD7 8
;DD8 9
ifEE 
(EE 
	dataTableEE 
!=EE 
nullEE !
)EE! "
{FF 
tryGG 
{HH 
forII 
(II 
intII 
iII 
=II  
$numII! "
;II" #
iII$ %
<II& '
	dataTableII( 1
.II1 2
RowsII2 6
.II6 7
CountII7 <
;II< =
iII> ?
++II? A
)IIA B
{JJ 
ProductKK 
productKK  '
=KK( )
newKK* -
ProductKK. 5
(KK5 6
)KK6 7
;KK7 8
productLL 
.LL  
IdLL  "
=LL# $
ConvertLL% ,
.LL, -
ToInt32LL- 4
(LL4 5
	dataTableLL5 >
.LL> ?
RowsLL? C
[LLC D
iLLD E
]LLE F
[LLF G
$strLLG K
]LLK L
)LLL M
;LLM N
productMM 
.MM  
NameMM  $
=MM% &
	dataTableMM' 0
.MM0 1
RowsMM1 5
[MM5 6
iMM6 7
]MM7 8
[MM8 9
$strMM9 ?
]MM? @
.MM@ A
ToStringMMA I
(MMI J
)MMJ K
;MMK L
productNN 
.NN  
DescriptionNN  +
=NN, -
	dataTableNN. 7
.NN7 8
RowsNN8 <
[NN< =
iNN= >
]NN> ?
[NN? @
$strNN@ M
]NNM N
.NNN O
ToStringNNO W
(NNW X
)NNX Y
;NNY Z
productOO 
.OO  
PriceOO  %
=OO& '
ConvertOO( /
.OO/ 0
ToInt32OO0 7
(OO7 8
	dataTableOO8 A
.OOA B
RowsOOB F
[OOF G
iOOG H
]OOH I
[OOI J
$strOOJ Q
]OOQ R
)OOR S
;OOS T
productsPP  
.PP  !
AddPP! $
(PP$ %
productPP% ,
)PP, -
;PP- .
}QQ 
}RR 
catchSS 
(SS 
	ExceptionSS  
eSS! "
)SS" #
{TT 
returnUU 
nullUU 
;UU  
}VV 
}WW 
returnXX 
productsXX 
;XX 
}YY 	
}ZZ 
}[[ À
dE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Utility\GoogleOAuthHelper.cs
	namespace 	
aspnet_web_api
 
. 
Utility  
{		 
public 

class 
GoogleOAuthHelper "
{ 
public 
async 
Task 
< 
GoogleOAuthResult +
>+ ,
ValidateToken- :
(: ;
string; A
tokenB G
)G H
{ 	
GoogleOAuthResult 
result $
=% &
new' *
GoogleOAuthResult+ <
(< =
)= >
;> ?
try 
{ "
GoogleJsonWebSignature &
.& '
Payload' .
payload/ 6
=7 8
await9 >"
GoogleJsonWebSignature? U
.U V
ValidateAsyncV c
(c d
tokend i
)i j
;j k
if 
( 
! 
payload 
. 
Audience %
.% &
Equals& ,
(, -
$str- w
)w x
)x y
result 
. 
ValidationResult +
=, -
false. 3
;3 4
if 
( 
! 
payload 
. 
Issuer #
.# $
Equals$ *
(* +
$str+ @
)@ A
&&B D
!E F
payloadF M
.M N
IssuerN T
.T U
EqualsU [
([ \
$str\ y
)y z
)z {
result 
. 
ValidationResult +
=, -
false. 3
;3 4
if 
( 
payload 
. !
ExpirationTimeSeconds 1
==2 4
null5 9
)9 :
result 
. 
ValidationResult +
=, -
false. 3
;3 4
else 
{ 
DateTime 
now  
=! "
DateTime# +
.+ ,
Now, /
./ 0
ToUniversalTime0 ?
(? @
)@ A
;A B
DateTime 

expiration '
=( )
DateTimeOffset* 8
.8 9
FromUnixTimeSeconds9 L
(L M
(M N
longN R
)R S
payloadS Z
.Z [!
ExpirationTimeSeconds[ p
)p q
.q r
DateTimer z
;z {
if 
( 
now 
> 

expiration (
)( )
{   
result!! 
.!! 
ValidationResult!! /
=!!0 1
false!!2 7
;!!7 8
}"" 
else## 
{$$ 
result%% 
.%% 
ValidationResult%% /
=%%0 1
true%%2 6
;%%6 7
}&& 
}'' 
result(( 
.(( 
Name(( 
=(( 
payload(( %
.((% &
Name((& *
;((* +
result)) 
.)) 
Email)) 
=)) 
payload)) &
.))& '
Email))' ,
;)), -
}** 
catch++ 
(++ 
InvalidJwtException++ &
e++' (
)++( )
{,, 
result-- 
.-- 
ValidationResult-- '
=--( )
false--* /
;--/ 0
}.. 
return// 
result// 
;// 
}00 	
}11 
}22 Å
]E:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Utility\GoogleSTMP.cs
	namespace		 	
aspnet_web_api		
 
.		 
Utility		  
{

 
public 

class 

GoogleSTMP 
{ 
public 
bool 
	SendEmail 
( 
Email #
model$ )
)) *
{ 	
using 
( 
MailMessage 
mailMessage *
=+ ,
new- 0
MailMessage1 <
(< =
$str= V
,V W
modelX ]
.] ^
To^ `
)` a
)a b
{ 
try 
{ 
mailMessage 
.  
Subject  '
=( )
model* /
./ 0
Subject0 7
;7 8
mailMessage 
.  
Body  $
=% &
model' ,
., -
Body- 1
;1 2
mailMessage 
.  

IsBodyHtml  *
=+ ,
false- 2
;2 3
using 
( 

SmtpClient %
smtp& *
=+ ,
new- 0

SmtpClient1 ;
(; <
)< =
)= >
{ 
smtp 
. 
Host !
=" #
$str$ 4
;4 5
smtp 
. 
	EnableSsl &
=' (
true) -
;- .
NetworkCredential )
NetworkCred* 5
=6 7
new8 ;
NetworkCredential< M
(M N
$strN g
,g h
$stri u
)u v
;v w
smtp 
. !
UseDefaultCredentials 2
=3 4
true5 9
;9 :
smtp 
. 
Credentials (
=) *
NetworkCred+ 6
;6 7
smtp 
. 
Port !
=" #
$num$ '
;' (
smtp 
. 
Send !
(! "
mailMessage" -
)- .
;. /
return 
true #
;# $
}   
}!! 
catch"" 
{## 
return$$ 
false$$  
;$$  !
}%% 
}'' 
}(( 	
})) 
}** Ñ
]E:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Utility\HashHelper.cs
	namespace 	
aspnet_web_api
 
. 
Utility  
{		 
public

 

class

 

HashHelper

 
{ 
public 
string 
GenerateSalt "
(" #
)# $
{ 	
byte 
[ 
] 
salt 
= 
new 
byte "
[" #
$num# &
/' (
$num) *
]* +
;+ ,
using 
( 
var 
rngCsp 
= 
new  #$
RNGCryptoServiceProvider$ <
(< =
)= >
)> ?
{ 
rngCsp 
. 
GetNonZeroBytes &
(& '
salt' +
)+ ,
;, -
} 
return 
Convert 
. 
ToBase64String )
() *
salt* .
). /
;/ 0
} 	
public 
string 
HashPassword "
(" #
string# )
password* 2
,2 3
string4 :
salt; ?
)? @
{ 	
byte 
[ 
] 
	saltBytes 
= 
Convert &
.& '
FromBase64String' 7
(7 8
salt8 <
)< =
;= >
string 
hashed 
= 
Convert #
.# $
ToBase64String$ 2
(2 3
KeyDerivation3 @
.@ A
Pbkdf2A G
(G H
password 
: 
password 
, 
salt 
: 
	saltBytes 
, 
prf 
: 
KeyDerivationPrf !
.! "

HMACSHA256" ,
,, -
iterationCount 
: 
$num "
," #
numBytesRequested   
:   
$num   "
/  # $
$num  % &
)  & '
)  ' (
;  ( )
return"" 
hashed"" 
;"" 
}## 	
}$$ 
}%% ß
]E:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Utility\JWTManager.cs
	namespace 	
aspnet_web_api
 
. 
Utility  
{ 
public 

class 

JWTManager 
{ 
private 
IConfiguration 
_config &
;& '
public 

JWTManager 
( 
IConfiguration (
config) /
)/ 0
{ 	
_config 
= 
config 
; 
} 	
public 
string  
GenerateJSONWebToken *
(* +
User+ /
user0 4
)4 5
{ 	 
SymmetricSecurityKey  
securityKey! ,
=- .
new/ 2 
SymmetricSecurityKey3 G
(G H
EncodingH P
.P Q
UTF8Q U
.U V
GetBytesV ^
(^ _
_config_ f
[f g
$strg p
]p q
)q r
)r s
;s t
SigningCredentials 
credentials *
=+ ,
new- 0
SigningCredentials1 C
(C D
securityKeyD O
,O P
SecurityAlgorithmsQ c
.c d

HmacSha256d n
)n o
;o p
var 
claims 
= 
new 
[ 
] 
{  
new 
Claim 
( #
JwtRegisteredClaimNames 1
.1 2
Jti2 5
,5 6
Guid7 ;
.; <
NewGuid< C
(C D
)D E
.E F
ToStringF N
(N O
)O P
)P Q
,Q R
new 
Claim 
( 
$str  
,  !
user" &
.& '
Role' +
)+ ,
} 
; 
JwtSecurityToken 
token "
=# $
new% (
JwtSecurityToken) 9
(9 :
_config: A
[A B
$strB N
]N O
,O P
_config   
[   
$str   "
]  " #
,  # $
claims!! 
,!! 
expires"" 
:"" 
DateTime"" 
.""  
Now""  #
.""# $

AddMinutes""$ .
("". /
$num""/ 2
)""2 3
,""3 4
signingCredentials##  
:##  !
credentials##" -
)##- .
;##. /
return%% 
new%% #
JwtSecurityTokenHandler%% .
(%%. /
)%%/ 0
.%%0 1

WriteToken%%1 ;
(%%; <
token%%< A
)%%A B
;%%B C
}&& 	
}'' 
}(( †
jE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Utility\MySqlDatabaseConnection.cs
	namespace 	
aspnet_web_api
 
. 
Utility  
{ 
public 

class #
MySqlDatabaseConnection (
{ 
public 
string 
Server 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
DatabaseName "
{# $
get% (
;( )
set* -
;- .
}/ 0
public		 
string		 
UserName		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 
string

 
Password

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 
MySql 
. 
Data 
. 
MySqlClient %
.% &
MySqlConnection& 5

Connection6 @
{A B
getC F
;F G
setH K
;K L
}M N
private 
static #
MySqlDatabaseConnection .
	_instance/ 8
=9 :
null; ?
;? @
private #
MySqlDatabaseConnection '
(' (
)( )
{* +
}, -
public 
static #
MySqlDatabaseConnection -
Instance. 6
(6 7
)7 8
{ 	
if 
( 
	_instance 
== 
null !
)! "
	_instance 
= 
new #
MySqlDatabaseConnection  7
(7 8
)8 9
;9 :
return 
	_instance 
; 
} 	
public 
bool 
Open 
( 
) 
{ 	
if 
( 

Connection 
== 
null "
)" #
{ 
if 
( 
String 
. 
IsNullOrEmpty (
(( )
DatabaseName) 5
)5 6
)6 7
return 
false  
;  !
string 

connstring !
=" #
string$ *
.* +
Format+ 1
(1 2
$str	2 ï
,
ï ñ
Server
ó ù
,
ù û
DatabaseName
ü ´
,
´ ¨
Password
≠ µ
)
µ ∂
;
∂ ∑

Connection 
= 
new  
MySql! &
.& '
Data' +
.+ ,
MySqlClient, 7
.7 8
MySqlConnection8 G
(G H

connstringH R
)R S
;S T

Connection 
. 
Open 
(  
)  !
;! "
} 
return!! 
true!! 
;!! 
}"" 	
public$$ 
void$$ 
Close$$ 
($$ 
)$$ 
{%% 	

Connection&& 
.&& 
Close&& 
(&& 
)&& 
;&& 
}'' 	
}(( 
})) ô/
eE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Utility\UserInputValidator.cs
	namespace 	
aspnet_web_api
 
. 
Utility  
{		 
public

 

class

 
UserInputValidator

 #
{ 
string 
[ 
] 
topLevel 
= 
{ 
$str $
,$ %
$str& ,
,, -
$str. 3
,3 4
$str5 ;
,; <
$str= B
,B C
$strD I
,I J
$strK P
,P Q
$strR W
,W X
$strY ^
,^ _
$str` e
,e f
$strg l
,l m
$strn s
}t u
;u v
private 
bool 
ValidateEmail "
(" #
User# '
user( ,
), -
{ 	
bool 
containsDomain 
=  !
false" '
;' (
if 
( 
user 
. 
Email 
. 
Contains #
(# $
$str$ '
)' (
)( )
{ 
foreach 
( 
string 
i  !
in" $
topLevel% -
)- .
{ 
if 
( 
! 
containsDomain &
)& '
{ 
if 
( 
user  
.  !
Email! &
.& '
Contains' /
(/ 0
i0 1
)1 2
)2 3
{ 
containsDomain *
=+ ,
true- 1
;1 2
} 
else 
{ 
containsDomain *
=+ ,
false- 2
;2 3
} 
} 
} 
return   
containsDomain   %
;  % &
}!! 
else"" 
{## 
return$$ 
containsDomain$$ %
;$$% &
}%% 
}&& 	
private(( 
bool(( 
CheckEmptyFields(( %
(((% &
User((& *
user((+ /
)((/ 0
{)) 	
bool** 
noEmpty** 
=** 
true** 
;**  
if,, 
(,, 
user,, 
.,, 
Email,, 
.,, 
Length,, !
==,," $
$num,,% &
||,,' )
user,,* .
.,,. /
Name,,/ 3
.,,3 4
Length,,4 :
==,,; =
$num,,> ?
||,,@ B
user,,C G
.,,G H
Password,,H P
.,,P Q
Length,,Q W
==,,X Z
$num,,[ \
),,\ ]
{-- 
noEmpty.. 
=.. 
false.. 
;..  
}// 
return11 
noEmpty11 
;11 
}22 	
public44 
string44 !
CheckPasswordStrength44 +
(44+ ,
string44, 2
password443 ;
)44; <
{55 	
Regex66 
rgx66 
=66 
new66 
Regex66 !
(66! "
$str66" 0
)660 1
;661 2
bool77 
hasSpecialChars77  
=77! "
rgx77# &
.77& '
IsMatch77' .
(77. /
password77/ 7
)777 8
;778 9
bool88 

hasNumbers88 
=88 
password88 &
.88& '
Any88' *
(88* +
char88+ /
.88/ 0
IsDigit880 7
)887 8
;888 9
bool99 

hasCapital99 
=99 
password99 &
.99& '
Any99' *
(99* +
char99+ /
.99/ 0
IsUpper990 7
)997 8
;998 9
if:: 
(:: 
password:: 
.:: 
Length:: 
<::  !
$num::" $
)::$ %
{;; 
return<< 
$str<< H
;<<H I
}== 
else>> 
if>> 
(>> 
!>> 
hasSpecialChars>> $
)>>$ %
{?? 
return@@ 
$str@@ P
;@@P Q
}AA 
elseBB 
ifBB 
(BB 
!BB 

hasNumbersBB  
)BB  !
{CC 
returnDD 
$strDD E
;DDE F
}EE 
elseFF 
ifFF 
(FF 
!FF 

hasCapitalFF  
)FF  !
{GG 
returnHH 
$strHH M
;HHM N
}II 
elseJJ 
{KK 
returnLL 
$strLL  
;LL  !
}MM 
}NN 	
publicPP 
stringPP %
ValidateRegistrationInputPP /
(PP/ 0
UserPP0 4
userPP5 9
)PP9 :
{QQ 	
stringRR 
passwordStrengthRR #
=RR$ %!
CheckPasswordStrengthRR& ;
(RR; <
userRR< @
.RR@ A
PasswordRRA I
)RRI J
;RRJ K
ifSS 
(SS 
!SS 
ValidateEmailSS 
(SS 
userSS #
)SS# $
)SS$ %
{TT 
returnUU 
$strUU =
;UU= >
}VV 
elseWW 
ifWW 
(WW 
!WW 
CheckEmptyFieldsWW %
(WW% &
userWW& *
)WW* +
)WW+ ,
{XX 
returnYY 
$strYY 0
;YY0 1
}ZZ 
else[[ 
if[[ 
([[ 
![[ 
passwordStrength[[ &
.[[& '
Equals[[' -
([[- .
$str[[. 7
)[[7 8
)[[8 9
{\\ 
return]] 
passwordStrength]] '
;]]' (
}^^ 
else__ 
{`` 
returnaa 
$straa  
;aa  !
}bb 
}dd 	
}ee 
}ff ∂
oE:\Software\Back End\C#\Cyber security S7\aspnet-web-api\aspnet-web-api\Utility\UserRoleAuthorizationManager.cs
	namespace 	
aspnet_web_api
 
. 
Utility  
{ 
public		 

class		 (
UserRoleAuthorizationManager		 -
{

 
public 
bool 
AuthoriseUser !
(! "
HttpContext" -
httpContext. 9
)9 :
{ 	
bool 

authorised 
= 
false #
;# $
if 
( 
httpContext 
. 
User  
.  !
HasClaim! )
() *
c* +
=>, .
c/ 0
.0 1
Type1 5
==6 8
$str9 w
&&x z
c{ |
.| }
Value	} Ç
==
É Ö
$str
Ü ê
)
ê ë
)
ë í
{ 

authorised 
= 
true !
;! "
} 
return 

authorised 
; 
} 	
public 
bool 
AuthoriseAdmin "
(" #
HttpContext# .
httpContext/ :
): ;
{ 	
bool 

authorised 
= 
false #
;# $
if 
( 
httpContext 
. 
User  
.  !
HasClaim! )
() *
c* +
=>, .
c/ 0
.0 1
Type1 5
==6 8
$str9 w
&&x z
c{ |
.| }
Value	} Ç
==
É Ö
$str
Ü ç
)
ç é
)
é è
{ 

authorised 
= 
true !
;! "
} 
return 

authorised 
; 
} 	
} 
} 